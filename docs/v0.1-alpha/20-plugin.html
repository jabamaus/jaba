<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us" lang="en-us">
  <head>
    <title>20-plugin</title>
    <link rel="stylesheet" href="https://rsms.me/inter/inter.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Fira+Code&display=swap">
    <link rel="stylesheet" href="../mamd.css">
  </head>
<body>
<h2>20-plugin</h2>

<p><sub><sup>This page applies to v0.1-alpha<br></sup></sub>
<a href="../index.html">home</a> &gt; <a href="index.html">0.1-alpha home</a></p>

<div class="CodeRay">
  <div class="code"><pre>text <span style="color:#A60">:example</span> <span style="color:#080;font-weight:bold">do</span>
  content <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">%Q{</span><span style="color:#D20">Add a block of raw text using ruby's %Q string literal notation.
Makes it easy to write formatted text including newlines
</span><span style="color:#710">}</span></span>
  line <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Add a line explicitly</span><span style="color:#710">'</span></span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>

<div class="CodeRay">
  <div class="code"><pre>type <span style="color:#A60">:text</span> <span style="color:#080;font-weight:bold">do</span>
  
  title <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Basic text file that is written to HDD</span><span style="color:#710">'</span></span>

  attr <span style="color:#A60">:filename</span>, <span style="color:#606">type</span>: <span style="color:#A60">:file</span> <span style="color:#080;font-weight:bold">do</span>
    title <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Path of the filename to be generated</span><span style="color:#710">'</span></span>
    basedir_spec <span style="color:#A60">:definition_root</span>
    default <span style="color:#080;font-weight:bold">do</span>
      <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>id<span style="font-weight:bold;color:#666">}</span></span><span style="color:#D20">.txt</span><span style="color:#710">&quot;</span></span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
  
  attr <span style="color:#A60">:content</span>, <span style="color:#606">type</span>: <span style="color:#A60">:to_s</span> <span style="color:#080;font-weight:bold">do</span>
    title <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Content as a single multiline string</span><span style="color:#710">'</span></span>
    note <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Directly set content of file as a string.</span><span style="color:#710">'</span></span>
  <span style="color:#080;font-weight:bold">end</span>
  
  attr_array <span style="color:#A60">:line</span>, <span style="color:#606">type</span>: <span style="color:#A60">:to_s</span> <span style="color:#080;font-weight:bold">do</span>
    title <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">Adds a line of content to file</span><span style="color:#710">'</span></span>
    flags <span style="color:#A60">:allow_dupes</span>, <span style="color:#A60">:no_sort</span>
  <span style="color:#080;font-weight:bold">end</span>
  
  attr <span style="color:#A60">:eol</span>, <span style="color:#606">type</span>: <span style="color:#A60">:choice</span> <span style="color:#080;font-weight:bold">do</span>
    title <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">'</span><span style="color:#D20">End of line style</span><span style="color:#710">'</span></span>
    items [<span style="color:#A60">:lf</span>, <span style="color:#A60">:crlf</span>, <span style="color:#A60">:native</span>]
    default <span style="color:#A60">:native</span>
  <span style="color:#080;font-weight:bold">end</span>

  plugin <span style="color:#A60">:text</span> <span style="color:#080;font-weight:bold">do</span>
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">generate</span>
      services.nodes.each <span style="color:#080;font-weight:bold">do</span> |n|
        attrs = n.attrs
        file = services.new_file(attrs.filename, <span style="color:#606">eol</span>: attrs.eol, <span style="color:#606">capacity</span>: <span style="color:#00D">1024</span>)
        w = file.writer
        c = attrs.content
        w.write_raw(c) <span style="color:#080;font-weight:bold">if</span> c
        lines = attrs.line
        <span style="color:#080;font-weight:bold">if</span> !lines.empty?
          w &lt;&lt; <span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="background-color:hsla(0,0%,0%,0.07);color:black"><span style="font-weight:bold;color:#666">#{</span>lines.join(<span style="background-color:hsla(0,100%,50%,0.05)"><span style="color:#710">&quot;</span><span style="color:#b0b">\n</span><span style="color:#710">&quot;</span></span>)<span style="font-weight:bold;color:#666">}</span></span><span style="color:#710">&quot;</span></span>
        <span style="color:#080;font-weight:bold">end</span>
        file.write
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>
    
    <span style="color:#080;font-weight:bold">def</span> <span style="color:#06B;font-weight:bold">build_output</span>(root)
      services.nodes.each <span style="color:#080;font-weight:bold">do</span> |n|
        root[<span style="color:#A60">:filename</span>] = n.attrs.filename
      <span style="color:#080;font-weight:bold">end</span>
    <span style="color:#080;font-weight:bold">end</span>
  <span style="color:#080;font-weight:bold">end</span>
<span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>

<p><sub><sup>Generated on 05-Sep-23 using <a href="https://github.com/vmg/redcarpet">Redcarpet</a>, <a href="https://rsms.me/inter">Inter</a> and <a href="https://github.com/tonsky/FiraCode">FiraCode</a>. css by Harry Denholm.</sup></sub></p>
</body>
</html>
